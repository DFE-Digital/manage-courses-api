<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="packages\GitInfo.2.0.3\build\GitInfo.targets" Condition="Exists('packages\GitInfo.2.0.3\build\GitInfo.targets')" />
  <PropertyGroup>
    <OutputType>Library</OutputType>
    <PackageId>GovUk.Education.ManageCourses.ApiClient</PackageId>
    <Authors>Department for Education</Authors>
    <Description>Client library to access the "Manage Courses" api</Description>
    <PackageRequireLicenseAcceptance>false</PackageRequireLicenseAcceptance>
    <PackageReleaseNotes>Pre-release</PackageReleaseNotes>
    <GenerateAssemblyInfo>true</GenerateAssemblyInfo>
  </PropertyGroup>
  <PropertyGroup>
    <TargetFramework>netcoreapp2.0</TargetFramework>
    <RootNamespace>GovUk.Education.ManageCourses.ApiClient</RootNamespace>
  </PropertyGroup>
  <PropertyGroup>
    <OutputSwaggerGeneration Condition="$(OutputSwaggerGeneration) == ''">Generated/ManageCoursesApiClient.cs</OutputSwaggerGeneration>
  </PropertyGroup>
  <ItemGroup>
    <Compile Remove="$(OutputSwaggerGeneration)" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="GitInfo" Version="2.0.11" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="2.0.2" />
    <PackageReference Include="NSwag.MSBuild" Version="11.17.13" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\ManageCourses.Api\ManageCourses.Api.csproj" />
  </ItemGroup>
  <ItemGroup>
    <None Update="integration-tests.json" CopyToOutputDirectory="PreserveNewest" />
    <None Update="ManageCourses.Api.runtimeconfig.json" CopyToOutputDirectory="Always" />
  </ItemGroup>
  <Target Name="SemanticVersioning" DependsOnTargets="GitVersion" AfterTargets="GitVersion" Outputs="$(OutputSwaggerGeneration)">
    <PropertyGroup Condition="'$(GitBranch)'=='master'">
      <Version>$(GitSemVerMajor).$(GitSemVerMinor).$(GitSemVerPatch)</Version>
      <PackageVersion>$(GitSemVerMajor).$(GitSemVerMinor).$(GitSemVerPatch)</PackageVersion>
    </PropertyGroup>
    <PropertyGroup Condition="'$(GitBranch)'!='master'">
      <Version>$(GitSemVerMajor).$(GitSemVerMinor)-$(GitBranch).$(GitSemVerPatch)</Version>
      <PackageVersion>$(GitSemVerMajor).$(GitSemVerMinor)-$(GitBranch).$(GitSemVerPatch)</PackageVersion>
    </PropertyGroup>    
  </Target>
  <Target Name="NSwag" BeforeTargets="CoreCompile" DependsOnTargets="ResolveProjectReferences" Outputs="$(OutputSwaggerGeneration)">
    <PropertyGroup>
      <classname>ManageCoursesApiClient</classname>
      <namespace>$(RootNamespace)</namespace>
      <clientBaseClass>$(namespace).ManageCoursesApiClientBase</clientBaseClass>
      <configurationClass>$(namespace).IManageCoursesApiClientConfiguration</configurationClass>
    </PropertyGroup>
    <Exec Command="$(NSwagExe_Core20) webapi2swagger /ReferencePaths:$(NugetPackageRoot) /assembly:@(_ResolvedProjectReferencePaths, ',') /controller:GovUk.Education.ManageCourses.Api.Controllers.* /output:$(OutDir)swagger.json" />
    <Exec Command="$(NSwagExe_Core20) swagger2csclient /input:$(OutDir)swagger.json /output:$(OutputSwaggerGeneration) /classname:$(classname) /namespace:$(namespace) /clientBaseClass:$(clientBaseClass) /configurationClass:$(configurationClass) /OperationGenerationMode:SingleClientFromOperationId " />
    <ItemGroup>
      <Compile Include="$(OutputSwaggerGeneration)" />
    </ItemGroup>
  </Target>
</Project>